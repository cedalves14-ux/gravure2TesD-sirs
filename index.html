<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
// === Variantes (prix) ===
const variants = [
  {label:"1 pièce", price:10},
  {label:"5 pièces", price:45},
  {label:"10 pièces", price:85},
  {label:"20 pièces", price:160}
];

// === Catégories avec produits exemples ===
const categories = {
  "Mariage / Anniversaire": [
    { id:1, title:"Coffret Mariage", desc:"Un coffret gravé unique pour votre mariage.", media:"Header2.png" },
    { id:2, title:"Plaque Anniversaire", desc:"Un souvenir gravé pour vos proches.", media:"Header2.png" }
  ],
  "Professionnel Gravure": [
    { id:3, title:"Plaque Entreprise", desc:"Logo et texte gravés pour votre société.", media:"Header2.png" }
  ],
  "Gaming Gravure": [
    { id:4, title:"Manette Personnalisée", desc:"Manette gravée selon vos envies.", media:"Header2.png" }
  ],
  "Décoration Maison": [
    { id:5, title:"Cadre Gravé", desc:"Décoration murale élégante.", media:"Header2.png" }
  ],
  "Demande personnalisation": [
    { id:6, title:"Produit Unique", desc:"Créez votre gravure sur mesure.", media:"Header2.png" }
  ]
};

// === DOM Elements ===
const grid = document.getElementById("products-grid");
const home = document.getElementById("home-page");
const productPage = document.getElementById("product-page");
const productMedia = document.getElementById("product-media");
const productTitle = document.getElementById("product-title");
const productDesc = document.getElementById("product-desc");
const variantsContainer = document.getElementById("variants-container");
const priceDiv = document.getElementById("price");
const buyBtn = document.getElementById("buyBtn");
const backBtn = document.getElementById("backBtn");
const categoryTitle = document.getElementById("category-title");
const categorySelect = document.getElementById("categorySelect");

let currentProduct = null;
let currentVariantIndex = 0;
let currentCategory = null;

// === Remplir le menu déroulant ===
Object.keys(categories).forEach(cat => {
  const opt = document.createElement("option");
  opt.value = cat;
  opt.textContent = cat;
  categorySelect.appendChild(opt);
});

// === Charger une catégorie ===
function loadCategory(category){
  currentCategory = category;
  grid.innerHTML = "";
  categoryTitle.textContent = category;

  const products = categories[category] || [];
  products.forEach(p=>{
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <div class="media-wrap">
        <img src="${p.media}" alt="">
      </div>
      <div class="card-body">
        <h3>${p.title}</h3>
        <span class="badge">Voir détails</span>
      </div>`;
    card.onclick = () => showProduct(p);
    grid.appendChild(card);
  });
}

// === Afficher la fiche produit ===
function showProduct(p){
  currentProduct = p;
  home.style.display = "none";
  productPage.style.display = "block";
  productPage.style.opacity = 1;

  productMedia.innerHTML = `<img src="${p.media}" alt="">`;
  productTitle.textContent = p.title;
  productDesc.textContent = p.desc;

  variantsContainer.innerHTML = "";
  variants.forEach((v, index) => {
    const btn = document.createElement("button");
    btn.className = "variant-btn" + (index === 0 ? " selected" : "");
    btn.textContent = `${v.label} — ${v.price}€`;
    btn.onclick = () => selectVariant(index);
    variantsContainer.appendChild(btn);
  });

  currentVariantIndex = 0;
  updatePrice();
}

// === Sélection variante ===
function selectVariant(index){
  currentVariantIndex = index;
  Array.from(variantsContainer.children).forEach((btn, i) => {
    btn.classList.toggle("selected", i === index);
  });
  updatePrice();
}

function updatePrice(){
  priceDiv.textContent = variants[currentVariantIndex].price + "€";
}

// === Bouton retour ===
backBtn.onclick = () => {
  home.style.display = "block"; 
  productPage.style.display = "none";
};

// === Bouton acheter ===
buyBtn.onclick = () => {
  alert(`Commande envoyée pour ${currentProduct.title} — ${variants[currentVariantIndex].label} à ${variants[currentVariantIndex].price}€ !`);
};

// === Popup accueil ===
function enterShop(){
  document.getElementById("categoryModal").style.display = "none";
  loadCategory("Mariage / Anniversaire");
  categorySelect.value = "Mariage / Anniversaire";
}

// === Menu déroulant avec transition fluide ===
categorySelect.onchange = () => {
  const selectedCat = categorySelect.value;
  if (selectedCat) {
    if (productPage.style.display === "block") {
      productPage.style.opacity = 1;
      const fadeOut = setInterval(() => {
        productPage.style.opacity -= 0.1;
        if (productPage.style.opacity <= 0) {
          clearInterval(fadeOut);
          productPage.style.display = "none";
          home.style.display = "block";
          home.style.opacity = 0;

          loadCategory(selectedCat);

          const fadeIn = setInterval(() => {
            home.style.opacity = parseFloat(home.style.opacity) + 0.1;
            if (home.style.opacity >= 1) clearInterval(fadeIn);
          }, 30);
        }
      }, 30);
    } else {
      loadCategory(selectedCat);
    }
  }
};
</script>
